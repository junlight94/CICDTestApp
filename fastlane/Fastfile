lane :test do
  # keychain ì´ˆê¸°í™”
    create_keychain(
      name: ENV["KEYCHAIN_NAME"],
      password: ENV["KEYCHAIN_PASSWORD"],
      timeout: 1800,
      default_keychain: true,
      unlock: true,
      lock_when_sleeps: false
    )
  # appstoreconnect apikey ì •ë³´
  app_store_connect_api_key(
      key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],
      issuer_id: ENV["APP_STORE_CONNECT_API_ISSUER_ID"],
      key_content: ENV["APP_STORE_CONNECT_API_KEY_CONTENT"]
    )
  
  # matchë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ì¦ì„œ ë° í”„ë¡œíŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    # match(
    #   git_url: "git@github.com:junlight94/certification_repo.git",
    #   storage_mode: "git",
    #   type: "appstore",
    #   readonly: true,
    #   keychain_name: ENV["KEYCHAIN_NAME"],
    #   keychain_password: ENV["KEYCHAIN_PASSWORD"]
    # )

  # cert, sign ë°©ë²•ì˜ ì¸ì¦
  get_certificates
  get_provisioning_profile

  
  # ë¹Œë“œ ë° ë‚´ë³´ë‚´ê¸° ğŸ—
    gym(
      workspace: ENV["XCWORKSPACE"],
      scheme: ENV["PRODUCTION_SCHEME"],
      export_options: {
        method: "app-store",
        signingStyle: "manual"
      }
    )
  # testflight ì—…ë¡œë“œ
    upload_to_testflight
end

  # slack ë…¸í‹°
  after_all do |lane|
    
    slack(
      message: "ì•±ì´ ì„±ê³µì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.",
      slack_url: "ìŠ¬ë™ í›…ìŠ¤ ë§í¬",
      )
  end
  
  # ì—ëŸ¬ ë°œìƒ ì‹œ í˜¸ì¶œ ë¨
  error do |lane, exception|
    slack(
      message: "ì•± ë°°í¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",
      slack_url: "ìŠ¬ë™ í›…ìŠ¤ ë§í¬",
      )
  end