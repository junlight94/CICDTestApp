lane :test do
  # keychain ì´ˆê¸°í™”
    create_keychain(
      name: ENV["KEYCHAIN_NAME"],
      password: ENV["KEYCHAIN_PASSWORD"],
      timeout: 1800,
      default_keychain: true,
      unlock: true,
      lock_when_sleeps: false
    )
  # appstoreconnect apikey ì •ë³´
  app_store_connect_api_key(
      key_id: ENV["APP_STORE_CONNECT_API_KEY_ID"],
      issuer_id: ENV["APP_STORE_CONNECT_API_ISSUER_ID"],
      key_content: ENV["APP_STORE_CONNECT_API_KEY_CONTENT"]
    )
  
  # matchë¥¼ ì‹¤í–‰í•˜ì—¬ ì¸ì¦ì„œ ë° í”„ë¡œíŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    match(
      readonly = true,
      clone_branch_directly = true,
      git_basic_authorization: 'junlight94@gmail.com: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',
      git_private_key: ENV["GIT_PRIVATE_KEY"],
      # git_url: "git@github.com:junlight94/certification_repo.git",
      storage_mode: "git",
      type: "appstore",
      readonly: true,
      keychain_name: ENV["KEYCHAIN_NAME"],
      keychain_password: ENV["KEYCHAIN_PASSWORD"]
    )

  # cert, sign ë°©ë²•ì˜ ì¸ì¦
  # get_certificates
  # get_provisioning_profile

  
  # ë¹Œë“œ ë° ë‚´ë³´ë‚´ê¸° ğŸ—
    gym(
      project: "CICDTestApp.xcodeproj",
      scheme: "CICDTestApp",
      export_options: {
        method: "app-store",
        signingStyle: "manual"
      }
    )
  # testflight ì—…ë¡œë“œ
    upload_to_testflight
end